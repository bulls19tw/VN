import React, { useState, useEffect, useMemo } from 'react';
import { Volume2, PenTool, Home, Star, ArrowRight, Check, X, Trophy, GraduationCap, ChevronLeft, ChevronRight, RotateCw, Music, Coffee, Sun, Info } from 'lucide-react';

// ==========================================
// 資料庫：超級擴充版越南語單字 (70個)
// ==========================================
const vocabularyData = [
  // 1. 問候與基本 (Greetings) - 10個
  { id: 1, vi: 'Xin chào', zh: '你好', guide: 'Sin chow', category: '問候' },
  { id: 2, vi: 'Cảm ơn', zh: '謝謝', guide: 'Cam uhn', category: '問候' },
  { id: 3, vi: 'Tạm biệt', zh: '再見', guide: 'Tam bee-et', category: '問候' },
  { id: 4, vi: 'Xin lỗi', zh: '抱歉/對不起', guide: 'Sin loy', category: '問候' },
  { id: 5, vi: 'Hẹn gặp lại', zh: '再見(下次見)', guide: 'Hen gap lai', category: '問候' },
  { id: 6, vi: 'Chào buổi sáng', zh: '早安', guide: 'Chow bu-oy sang', category: '問候' },
  { id: 7, vi: 'Chào buổi tối', zh: '晚安(問候)', guide: 'Chow bu-oy toy', category: '問候' },
  { id: 8, vi: 'Chúc ngủ ngon', zh: '晚安(睡前)', guide: 'Chook ngu ngawn', category: '問候' },
  { id: 9, vi: 'Bạn khỏe không', zh: '你好嗎?', guide: 'Ban kwe khom', category: '問候' },
  { id: 10, vi: 'Tôi tên là', zh: '我的名字是...', guide: 'Toy ten la', category: '問候' },

  // 2. 食物 (Food) - 12個
  { id: 11, vi: 'Phở', zh: '河粉', guide: 'Fuh', category: '食物' },
  { id: 12, vi: 'Bánh mì', zh: '越南麵包', guide: 'Ban mee', category: '食物' },
  { id: 13, vi: 'Cà phê', zh: '咖啡', guide: 'Ka fey', category: '食物' },
  { id: 14, vi: 'Bún chả', zh: '烤肉米線', guide: 'Boon cha', category: '食物' },
  { id: 15, vi: 'Gỏi cuốn', zh: '生春捲', guide: 'Goi coon', category: '食物' },
  { id: 16, vi: 'Cơm tấm', zh: '碎米飯', guide: 'Com tam', category: '食物' },
  { id: 17, vi: 'Cơm', zh: '米飯', guide: 'Com', category: '食物' },
  { id: 18, vi: 'Bún bò Huế', zh: '順化牛肉米線', guide: 'Boon bo hway', category: '食物' },
  { id: 19, vi: 'Nem rán', zh: '炸春捲', guide: 'Nem ran', category: '食物' },
  { id: 20, vi: 'Bia', zh: '啤酒', guide: 'Bee-a', category: '食物' },
  { id: 21, vi: 'Nước', zh: '水', guide: 'Nu-oc', category: '食物' },
  { id: 22, vi: 'Trái cây', zh: '水果', guide: 'Chai kay', category: '食物' },

  // 3. 數字 (Numbers) - 13個
  { id: 23, vi: 'Một', zh: '一', guide: 'Mote', category: '數字' },
  { id: 24, vi: 'Hai', zh: '二', guide: 'Hi', category: '數字' },
  { id: 25, vi: 'Ba', zh: '三', guide: 'Ba', category: '數字' },
  { id: 26, vi: 'Bốn', zh: '四', guide: 'Bone', category: '數字' },
  { id: 27, vi: 'Năm', zh: '五', guide: 'Nam', category: '數字' },
  { id: 28, vi: 'Sáu', zh: '六', guide: 'Sa-u', category: '數字' },
  { id: 29, vi: 'Bảy', zh: '七', guide: 'Bai', category: '數字' },
  { id: 30, vi: 'Tám', zh: '八', guide: 'Tam', category: '數字' },
  { id: 31, vi: 'Chín', zh: '九', guide: 'Chin', category: '數字' },
  { id: 32, vi: 'Mười', zh: '十', guide: 'Muu-ey', category: '數字' },
  { id: 33, vi: 'Trăm', zh: '百', guide: 'Tram', category: '數字' },
  { id: 34, vi: 'Nghìn', zh: '千', guide: 'Ngin', category: '數字' },
  { id: 35, vi: 'Không', zh: '零', guide: 'Khom', category: '數字' },

  // 4. 家庭與稱謂 (Titles) - 12個
  { id: 36, vi: 'Ông', zh: '爺爺/先生', guide: 'Om', category: '稱謂' },
  { id: 37, vi: 'Bà', zh: '奶奶/女士', guide: 'Ba', category: '稱謂' },
  { id: 38, vi: 'Ba / Bố', zh: '爸爸', guide: 'Ba / Bo', category: '稱謂' },
  { id: 39, vi: 'Mẹ', zh: '媽媽', guide: 'Me', category: '稱謂' },
  { id: 40, vi: 'Anh', zh: '哥哥(或年輕男子)', guide: 'An', category: '稱謂' },
  { id: 41, vi: 'Chị', zh: '姊姊(或年輕女子)', guide: 'Chi', category: '稱謂' },
  { id: 42, vi: 'Em', zh: '弟弟/妹妹', guide: 'Em', category: '稱謂' },
  { id: 43, vi: 'Thầy giáo', zh: '男老師', guide: 'Tay zao', category: '稱謂' },
  { id: 44, vi: 'Cô giáo', zh: '女老師', guide: 'Ko zao', category: '稱謂' },
  { id: 45, vi: 'Bạn', zh: '朋友/你', guide: 'Ban', category: '稱謂' },
  { id: 46, vi: 'Chú', zh: '叔叔', guide: 'Chu', category: '稱謂' },
  { id: 47, vi: 'Cô', zh: '阿姨/姑姑', guide: 'Ko', category: '稱謂' },

  // 5. 生活與動詞 (Life) - 13個
  { id: 48, vi: 'Ăn', zh: '吃', guide: 'An', category: '生活' },
  { id: 49, vi: 'Uống', zh: '喝', guide: 'Uom', category: '生活' },
  { id: 50, vi: 'Đi', zh: '去/走', guide: 'Dee', category: '生活' },
  { id: 51, vi: 'Ngủ', zh: '睡覺', guide: 'Ngoo', category: '生活' },
  { id: 52, vi: 'Mua', zh: '買', guide: 'Moo-a', category: '生活' },
  { id: 53, vi: 'Yêu', zh: '愛', guide: 'Eww', category: '生活' },
  { id: 54, vi: 'Làm việc', zh: '工作', guide: 'Lam veek', category: '生活' },
  { id: 55, vi: 'Học', zh: '學習', guide: 'Hop', category: '生活' },
  { id: 56, vi: 'Nghe', zh: '聽', guide: 'Nge', category: '生活' },
  { id: 57, vi: 'Nói', zh: '說', guide: 'Noy', category: '生活' },
  { id: 58, vi: 'Đọc', zh: '讀', guide: 'Doc', category: '生活' },
  { id: 59, vi: 'Viết', zh: '寫', guide: 'Veet', category: '生活' },
  { id: 60, vi: 'Thích', zh: '喜歡', guide: 'Tick', category: '生活' },

  // 6. 文化 (Culture) - 10個
  { id: 61, vi: 'Nón lá', zh: '斗笠', guide: 'Non la', category: '文化' },
  { id: 62, vi: 'Áo dài', zh: '奧黛(長衫)', guide: 'Ow yai', category: '文化' },
  { id: 63, vi: 'Xe máy', zh: '摩托車', guide: 'Se mai', category: '文化' },
  { id: 64, vi: 'Tết', zh: '農曆新年', guide: 'Tet', category: '文化' },
  { id: 65, vi: 'Hoa sen', zh: '蓮花', guide: 'Hwa sen', category: '文化' },
  { id: 66, vi: 'Đèn lồng', zh: '燈籠', guide: 'Den lom', category: '文化' },
  { id: 67, vi: 'Xích lô', zh: '人力三輪車', guide: 'Sick low', category: '文化' },
  { id: 68, vi: 'Múa rối nước', zh: '水上木偶', guide: 'Mua roy nuoc', category: '文化' },
  { id: 69, vi: 'Chùa', zh: '寺廟', guide: 'Chua', category: '文化' },
  { id: 70, vi: 'Rồng', zh: '龍', guide: 'Zom', category: '文化' },
];

const tonesData = [
  { symbol: 'a', name: '平聲 (Ngang)', desc: '平平的，高音平調', example: 'Ma' },
  { symbol: 'à', name: '玄聲 (Huyền)', desc: '低沈，從中音降到低音', example: 'Mà' },
  { symbol: 'á', name: '銳聲 (Sắc)', desc: '上揚，短促有力向上', example: 'Má' },
  { symbol: 'ả', name: '問聲 (Hỏi)', desc: '先降後升，像問問題', example: 'Mả' },
  { symbol: 'ã', name: '跌聲 (Ngã)', desc: '高音中斷，像跌倒又爬起', example: 'Mã' },
  { symbol: 'ạ', name: '重聲 (Nặng)', desc: '短促沈重，點在字下', example: 'Mạ' },
];

const vowelsData = [
  { char: 'a', desc: '嘴巴張大' },
  { char: 'ă', desc: '短音 a (像月亮)' },
  { char: 'â', desc: '短音 ơ (像戴帽子)' },
  { char: 'e', desc: '像 "ㄟ" (嘴咧開)' },
  { char: 'ê', desc: '像 "ㄝ" (戴帽子)' },
  { char: 'o', desc: '嘴巴圓圓' },
  { char: 'ô', desc: '像 "ㄡ" (戴帽子)' },
  { char: 'ơ', desc: '像 "ㄜ" (長鬍鬚)' },
  { char: 'u', desc: '像 "ㄨ"' },
  { char: 'ư', desc: '扁嘴 u (長鬍鬚)' },
];

const categories = ['全部', ...new Set(vocabularyData.map(item => item.category))];

// ==========================================
// 越南文化小知識庫 (12則)
// ==========================================
const culturalFacts = [
  {
    title: "獨特的咖啡文化",
    content: "越南咖啡 (Cà phê) 通常使用煉乳而不是鮮奶，因為在熱帶氣候下煉乳更容易保存。使用「滴漏壺 (Phin)」慢慢滴濾，是體驗越南慢活的最佳方式。",
    icon: <Coffee size={24} className="text-[#6D4C41]" />
  },
  {
    title: "奧黛 (Áo Dài)",
    content: "奧黛是越南的國服，特色是上身緊身、下身開衩至腰部，內搭長褲。傳統上，白色奧黛是高中女生的校服，象徵純潔與青春。",
    icon: <GraduationCap size={24} className="text-[#33691E]" />
  },
  {
    title: "摩托車王國",
    content: "越南是世界上摩托車保有量最高的國家之一。在尖峰時刻，你會看到壯觀的「摩托車海」。過馬路時記得保持穩定速度前進，騎士會自動避開你！",
    icon: <Sun size={24} className="text-[#F57F17]" /> 
  },
  {
    title: "法國麵包 (Bánh Mì)",
    content: "越南麵包源自法國殖民時期的長棍麵包 (Baguette)，但越南人加入了豬肝醬、醃蘿蔔、香菜和辣椒，改良成獨一無二的越式風味。",
    icon: <Info size={24} className="text-[#BF360C]" />
  },
  {
    title: "水上木偶戲",
    content: "這是越南獨有的傳統藝術，表演者躲在竹簾後，站在深及腰部的水中操作木偶。這原本是農閒時在水田中娛樂村民的活動喔！",
    icon: <Music size={24} className="text-[#0277BD]" />
  },
  {
    title: "蓮花 (Hoa Sen)",
    content: "蓮花是越南的國花，象徵著純潔、承諾和樂觀。越南人非常喜愛蓮花，甚至會將茶葉放入蓮花苞中薰香，製成珍貴的「蓮花茶」。",
    icon: <Sun size={24} className="text-[#EC407A]" />
  },
  {
    title: "農曆新年 (Tết)",
    content: "越南也過農曆新年，稱為「Tết」。這是越南最重要、最長的節日。家家戶戶會擺放桃花(北方)或黃梅花(南方)，並吃方形的粽子 (Bánh Chưng)。",
    icon: <Star size={24} className="text-[#D84315]" />
  },
  {
    title: "河粉 (Phở)",
    content: "Phở 的湯頭非常講究，通常用牛骨熬煮數小時，並加入肉桂、八角、烤洋蔥等香料。吃的時候記得加入新鮮的九層塔、豆芽和萊姆汁提味！",
    icon: <Coffee size={24} className="text-[#3E2723]" /> 
  },
  {
    title: "斗笠 (Nón Lá)",
    content: "斗笠不僅能遮陽避雨，越南婦女去市場買菜時，有時還會把斗笠翻過來當作籃子裝東西，非常實用！",
    icon: <Sun size={24} className="text-[#FBC02D]" />
  },
  {
    title: "名字的順序",
    content: "越南人的名字順序是「姓 + 墊名 + 名」。例如「阮文雄」，阮是姓，文是墊名，雄是名。稱呼對方時，通常只叫最後一個字（名）。",
    icon: <PenTool size={24} className="text-[#00897B]" />
  },
  {
    title: "水上市場",
    content: "在湄公河三角洲（如芹苴），有著熱鬧的水上市場。商船會在船頭掛上販賣的農產品（如掛一顆鳳梨），讓遠處的買家一眼就能看到賣什麼。",
    icon: <Volume2 size={24} className="text-[#0288D1]" /> 
  },
  {
    title: "粽子不一定是三角形",
    content: "越南的粽子有方形的 (Bánh Chưng) 和圓柱形的 (Bánh Tét)。傳說方形象徵大地，是過年祭拜祖先必備的傳統食物。",
    icon: <Info size={24} className="text-[#2E7D32]" />
  }
];

// ==========================================
// 前景用 SVG 圖示組件
// ==========================================

const JunkBoatIcon = ({ className }) => (
  <svg viewBox="0 0 120 100" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M15 70 Q60 90 105 70 L100 65 L20 65 Z" fill="#5D4037" />
    <path d="M20 65 L100 65 L103 62 L17 62 Z" fill="#3E2723" />
    <path d="M25 72 L95 72" stroke="#795548" strokeWidth="1" opacity="0.5" />
    <path d="M30 78 L90 78" stroke="#795548" strokeWidth="1" opacity="0.5" />
    <path d="M58 60 L58 10 Q15 25 20 60 Z" fill="#B71C1C" />
    <path d="M25 50 L58 45" stroke="#D32F2F" strokeWidth="1" opacity="0.5" />
    <path d="M22 40 L58 35" stroke="#D32F2F" strokeWidth="1" opacity="0.5" />
    <path d="M21 30 L58 25" stroke="#D32F2F" strokeWidth="1" opacity="0.5" />
    <path d="M62 60 L62 20 Q95 30 90 60 Z" fill="#E57373" />
    <path d="M62 50 L88 52" stroke="#EF9A9A" strokeWidth="1" opacity="0.6" />
    <path d="M62 40 L86 42" stroke="#EF9A9A" strokeWidth="1" opacity="0.6" />
    <path d="M5 75 Q20 70 35 75 T65 75 T95 75 T125 75" stroke="#81D4FA" strokeWidth="2" strokeLinecap="round" opacity="0.8" />
    <path d="M10 82 Q25 77 40 82 T70 82 T100 82" stroke="#4FC3F7" strokeWidth="2" strokeLinecap="round" opacity="0.6" />
  </svg>
);

const PhinCoffeeIcon = ({ className }) => (
  <svg viewBox="0 0 80 100" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M25 55 L28 85 Q28 90 33 90 L47 90 Q52 90 52 85 L55 55" fill="rgba(255,255,255,0.4)" stroke="#90A4AE" strokeWidth="1" />
    <path d="M28 80 L29 85 Q29 89 33 89 L47 89 Q51 89 51 85 L52 80 Q40 82 28 80 Z" fill="#FFF9C4" />
    <path d="M26 65 L28 80 Q40 82 52 80 L54 65 Q40 67 26 65 Z" fill="#3E2723" />
    <ellipse cx="40" cy="55" rx="22" ry="3" fill="#B0BEC5" stroke="#546E7A" strokeWidth="1" />
    <path d="M25 55 L25 35 L55 35 L55 55 Z" fill="#CFD8DC" stroke="#78909C" strokeWidth="1" />
    <rect x="25" y="30" width="30" height="5" fill="#B0BEC5" stroke="#78909C" strokeWidth="1" />
    <path d="M23 30 Q40 25 57 30" fill="#90A4AE" stroke="#546E7A" strokeWidth="1" />
    <rect x="38" y="24" width="4" height="4" fill="#546E7A" />
    <circle cx="40" cy="62" r="2.5" fill="#3E2723">
      <animate attributeName="cy" from="58" to="80" dur="2s" repeatCount="indefinite" />
      <animate attributeName="opacity" values="1;0" dur="2s" repeatCount="indefinite" />
    </circle>
  </svg>
);

const ScooterIcon = ({ className }) => (
  <svg viewBox="0 0 100 80" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="75" cy="60" r="11" fill="#37474F" />
    <circle cx="75" cy="60" r="6" fill="#ECEFF1" stroke="#90A4AE" strokeWidth="2" />
    <circle cx="25" cy="60" r="11" fill="#37474F" />
    <circle cx="25" cy="60" r="6" fill="#ECEFF1" stroke="#90A4AE" strokeWidth="2" />
    <path d="M25 60 L75 60 Q85 60 85 45 Q85 30 70 30 L55 30 L45 45 L25 45 L20 25" fill="#80CBC4" stroke="#00897B" strokeWidth="1" />
    <path d="M10 50 Q10 40 25 40 L35 40 L30 55 Z" fill="#80CBC4" stroke="#00897B" strokeWidth="1" />
    <path d="M50 30 L75 30 Q80 30 78 36 L52 36 Z" fill="#8D6E63" />
    <circle cx="18" cy="22" r="4" fill="#FFF9C4" stroke="#FBC02D" strokeWidth="1" />
    <path d="M18 25 L10 28" stroke="#37474F" strokeWidth="2" strokeLinecap="round" />
  </svg>
);

const AoDaiHatIcon = ({ className }) => (
  <svg viewBox="0 0 120 140" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="60" cy="55" r="25" fill="#FFCCBC" />
    <path d="M38 45 Q60 30 82 45 L85 65 Q60 55 35 65 Z" fill="#3E2723" />
    <path d="M60 5 L110 50 L10 50 Z" fill="#FFF59D" stroke="#FBC02D" strokeWidth="2" />
    <path d="M35 25 Q60 30 85 25" stroke="#F9A825" strokeWidth="1" opacity="0.7" fill="none" />
    <path d="M22 38 Q60 45 98 38" stroke="#F9A825" strokeWidth="1" opacity="0.7" fill="none" />
    <path d="M60 5 L60 25" stroke="#F9A825" strokeWidth="1" opacity="0.5" />
    <path d="M45 15 L50 35" stroke="#F9A825" strokeWidth="1" opacity="0.5" />
    <path d="M75 15 L70 35" stroke="#F9A825" strokeWidth="1" opacity="0.5" />
    <ellipse cx="50" cy="60" rx="3" ry="4" fill="#3E2723" />
    <ellipse cx="70" cy="60" rx="3" ry="4" fill="#3E2723" />
    <path d="M55 70 Q60 75 65 70" stroke="#3E2723" strokeWidth="1.5" fill="none" />
    <ellipse cx="42" cy="68" rx="5" ry="3" fill="#F48FB1" opacity="0.6" />
    <ellipse cx="78" cy="68" rx="5" ry="3" fill="#F48FB1" opacity="0.6" />
    <path d="M45 80 Q60 75 75 80 L85 135 Q60 140 35 135 Z" fill="#A5D6A7" />
    <path d="M50 80 L60 90 L70 80" stroke="#388E3C" strokeWidth="1.5" fill="none" />
    <path d="M45 80 Q35 110 35 135" stroke="#388E3C" strokeWidth="1.5" fill="none" opacity="0.6" />
    <circle cx="55" cy="105" r="3" fill="#F8BBD0" />
    <circle cx="70" cy="115" r="3" fill="#F8BBD0" />
    <circle cx="45" cy="125" r="3" fill="#F8BBD0" />
  </svg>
);

// ==========================================
// 全新背景用 SVG 組件
// ==========================================

const LanternsDecoration = ({ className }) => (
  <svg viewBox="0 0 300 100" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 10 Q150 40 300 10" stroke="#3E2723" strokeWidth="1" fill="none" />
    <line x1="50" y1="20" x2="50" y2="35" stroke="#3E2723" strokeWidth="1" />
    <circle cx="50" cy="45" r="10" fill="#EF5350" opacity="0.8" />
    <path d="M50 35 Q40 45 50 55 Q60 45 50 35" stroke="#FFCDD2" strokeWidth="1" fill="none" opacity="0.5" />
    <line x1="50" y1="55" x2="50" y2="65" stroke="#EF5350" strokeWidth="1" opacity="0.6" />
    <line x1="120" y1="28" x2="120" y2="40" stroke="#3E2723" strokeWidth="1" />
    <ellipse cx="120" cy="52" rx="8" ry="12" fill="#FFA726" opacity="0.8" />
    <line x1="120" y1="40" x2="120" y2="64" stroke="#FFE0B2" strokeWidth="1" opacity="0.5" />
    <line x1="120" y1="64" x2="120" y2="74" stroke="#FFA726" strokeWidth="1" opacity="0.6" />
    <line x1="200" y1="28" x2="200" y2="40" stroke="#3E2723" strokeWidth="1" />
    <path d="M200 40 L212 52 L200 64 L188 52 Z" fill="#66BB6A" opacity="0.8" />
    <line x1="200" y1="64" x2="200" y2="74" stroke="#66BB6A" strokeWidth="1" opacity="0.6" />
    <line x1="270" y1="18" x2="270" y2="30" stroke="#3E2723" strokeWidth="1" />
    <rect x="264" y="30" width="12" height="20" rx="4" fill="#42A5F5" opacity="0.8" />
    <line x1="270" y1="50" x2="270" y2="60" stroke="#42A5F5" strokeWidth="1" opacity="0.6" />
  </svg>
);

const BambooBackground = ({ className }) => (
  <svg viewBox="0 0 200 400" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M40 400 L40 0" stroke="#AED581" strokeWidth="8" opacity="0.4" />
    <path d="M36 300 H44 M36 200 H44 M36 100 H44" stroke="#81C784" strokeWidth="2" opacity="0.5" />
    <path d="M90 400 L95 0" stroke="#C5E1A5" strokeWidth="6" opacity="0.3" />
    <path d="M86 320 H98 M87 240 H97 M88 160 H96" stroke="#9CCC65" strokeWidth="2" opacity="0.4" />
    <path d="M44 200 Q60 180 50 160 Q40 180 44 200" fill="#81C784" opacity="0.4" />
    <path d="M44 200 Q30 180 34 160 Q44 180 44 200" fill="#81C784" opacity="0.4" />
    <path d="M95 160 Q110 140 100 120 Q90 140 95 160" fill="#AED581" opacity="0.3" />
  </svg>
);

const RiceTerrace = ({ className }) => (
  <svg viewBox="0 0 400 150" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 20 Q100 60 200 40 T400 50" stroke="#C8E6C9" strokeWidth="2" fill="none" opacity="0.6" />
    <path d="M0 50 Q120 90 220 70 T400 80" stroke="#A5D6A7" strokeWidth="2" fill="none" opacity="0.5" />
    <path d="M0 80 Q140 120 240 100 T400 110" stroke="#81C784" strokeWidth="2" fill="none" opacity="0.4" />
    <path d="M0 110 Q160 150 260 130 T400 140" stroke="#66BB6A" strokeWidth="2" fill="none" opacity="0.3" />
  </svg>
);

const BackgroundPattern = () => (
  <div className="fixed inset-0 pointer-events-none z-0 overflow-hidden bg-[#FFFEF5]">
    <div className="absolute inset-0 opacity-40" 
         style={{ backgroundImage: 'radial-gradient(#E0E0E0 1px, transparent 1px)', backgroundSize: '24px 24px' }}>
    </div>
    
    <div className="absolute top-0 left-[-20px] w-64 h-32 opacity-60">
      <LanternsDecoration className="w-full h-full" />
    </div>
    
    <div className="absolute top-[-10px] right-[-40px] w-64 h-32 opacity-50 transform scale-x-[-1] rotate-6">
      <LanternsDecoration className="w-full h-full" />
    </div>

    <div className="absolute top-20 left-0 w-40 h-full opacity-40">
      <BambooBackground className="w-full h-full object-cover" />
    </div>

    <div className="absolute top-40 right-[-20px] w-32 h-full opacity-30 transform scale-x-[-1]">
      <BambooBackground className="w-full h-full object-cover" />
    </div>

    <div className="absolute bottom-0 left-0 w-full h-48 opacity-60">
       <RiceTerrace className="w-full h-full" />
    </div>
  </div>
);

// ==========================================
// 主應用程式
// ==========================================
export default function VietnameseLearningApp() {
  const [currentView, setCurrentView] = useState('home'); 
  const [score, setScore] = useState(0);
  
  const speak = (text) => {
    if ('speechSynthesis' in window) {
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'vi-VN'; 
      utterance.rate = 0.8; 
      window.speechSynthesis.speak(utterance);
    }
  };

  const renderView = () => {
    switch (currentView) {
      case 'learning':
        return <LearningView goHome={() => setCurrentView('home')} speak={speak} />;
      case 'listening':
        return <ListeningGame goHome={() => setCurrentView('home')} speak={speak} addScore={() => setScore(s => s + 10)} />;
      case 'writing':
        return <WritingGame goHome={() => setCurrentView('home')} speak={speak} addScore={() => setScore(s => s + 10)} />;
      default:
        return <HomeView setView={setCurrentView} score={score} />;
    }
  };

  return (
    <div className="min-h-screen font-sans text-[#5D4037] relative selection:bg-[#FFCC80] selection:text-[#3E2723]">
      <BackgroundPattern />
      
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Mali:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap');
        body { font-family: 'Nunito', sans-serif; }
        h1, h2, h3, h4, .cute-font { font-family: 'Mali', cursive; }
        
        .perspective-1000 { perspective: 1000px; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        @keyframes float {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-8px); }
        }
        .animate-float { animation: float 4s ease-in-out infinite; }
        
        .glass-card {
          background: rgba(255, 255, 255, 0.9);
          backdrop-filter: blur(8px);
          border: 1px solid rgba(255, 255, 255, 0.8);
          box-shadow: 0 8px 16px -4px rgba(109, 76, 65, 0.1);
        }
      `}</style>

      {/* 導航列 */}
      <nav className="px-6 py-4 flex justify-between items-center sticky top-0 z-50 transition-all duration-300 bg-white/70 backdrop-blur-md border-b border-[#D7CCC8]/30">
        <div 
          className="flex items-center gap-3 cursor-pointer group" 
          onClick={() => setCurrentView('home')}
        >
          <div className="w-10 h-10 bg-[#C62828] rounded-xl flex items-center justify-center text-[#FFEB3B] shadow-md transform group-hover:rotate-6 transition-transform border border-[#EF9A9A]">
            <Star size={24} fill="currentColor" />
          </div>
          <div className="flex flex-col">
            <h1 className="text-xl font-bold text-[#C62828] leading-none tracking-tight">Xin Chào</h1>
            <span className="text-xs text-[#8D6E63] font-bold tracking-widest">VIETNAMESE</span>
          </div>
        </div>
        
        <div className="flex items-center gap-2 bg-[#FFF3E0] px-4 py-1.5 rounded-full border border-[#FFE0B2] shadow-sm">
          <Trophy size={18} className="text-[#FB8C00] fill-[#FB8C00]" />
          <span className="font-bold text-[#5D4037]">{score}</span>
        </div>
      </nav>

      {/* 主要內容區 */}
      <main className="container mx-auto px-4 py-8 max-w-2xl relative z-10 min-h-[85vh]">
        {renderView()}
      </main>

      <footer className="w-full text-center py-6 text-[#A1887F] text-xs relative z-10 font-medium">
        <p>© 2025 你好！來學越南語 • 阿信的Gemini Canvas實驗室</p>
      </footer>
    </div>
  );
}

// ==========================================
// 1. 首頁視圖 (隨機文化小知識)
// ==========================================
const HomeView = ({ setView }) => {
  const dailyFact = useMemo(() => {
    const randomIndex = Math.floor(Math.random() * culturalFacts.length);
    return culturalFacts[randomIndex];
  }, []);

  return (
    <div className="flex flex-col gap-8 items-center animate-fade-in">
      {/* Hero Section */}
      <div className="relative w-full py-6 flex flex-col items-center justify-center">
        <div className="relative group cursor-pointer" onClick={() => setView('learning')}>
          {/* 光環動畫 */}
          <div className="absolute inset-0 bg-[#FFD54F] rounded-full blur-3xl opacity-30 group-hover:opacity-50 transition-opacity duration-500 animate-pulse"></div>
          
          {/* 主圖標 */}
          <div className="relative w-48 h-48 bg-gradient-to-br from-[#FFFDE7] to-[#FFFFFF] rounded-full flex items-center justify-center shadow-xl border-4 border-[#FFF9C4] transform transition-transform duration-300 group-hover:-translate-y-2 overflow-hidden ring-4 ring-white/50">
            <div className="absolute bottom-0 w-full h-1/2 bg-[#C8E6C9] opacity-30 rounded-b-full"></div>
            
            {/* 人物圖示：位置上移 (-translate-y-3)，z-index 設為 0 */}
            <AoDaiHatIcon className="w-32 h-32 relative z-0 -translate-y-3" />
            
            {/* 紅色按鈕：z-index 設為 10 確保浮在人物上方 */}
            <div className="absolute bottom-5 z-10 bg-[#C62828] text-[#FFFDE7] px-5 py-1.5 rounded-full shadow-lg text-sm font-bold border border-[#EF9A9A] tracking-wide group-hover:scale-105 transition-transform">
              Bắt đầu (開始)
            </div>
          </div>
        </div>

        <div className="mt-8 text-center space-y-2 max-w-md">
          <h2 className="text-3xl font-bold text-[#4E342E] cute-font tracking-wide drop-shadow-sm">
            你好！來學越南語
          </h2>
          <p className="text-[#8D6E63] font-medium text-sm">
            輕鬆自學樂趣多
          </p>
        </div>
      </div>

      {/* 選單卡片區 Grid Layout */}
      <div className="grid grid-cols-1 gap-4 w-full px-2">
        {/* 基礎教室 - 復古綠 */}
        <MenuCard 
          onClick={() => setView('learning')}
          theme="green"
          icon={<GraduationCap size={26} className="text-[#33691E]" />}
          title="基礎教室"
          subtitle="Lớp học cơ bản"
          desc="單字卡、聲調與發音表"
          rightIcon={<PhinCoffeeIcon className="w-16 h-16 opacity-90" />}
        />

        {/* 聽力挑戰 - 復古藍 */}
        <MenuCard 
          onClick={() => setView('listening')}
          theme="blue"
          icon={<Volume2 size={26} className="text-[#01579B]" />}
          title="聽力挑戰"
          subtitle="Luyện nghe"
          desc="聆聽發音，選擇正確意思"
          rightIcon={<JunkBoatIcon className="w-24 h-20 opacity-90 -mr-2" />}
        />

        {/* 單字拼寫 - 復古橘紅 */}
        <MenuCard 
          onClick={() => setView('writing')}
          theme="red"
          icon={<PenTool size={26} className="text-[#BF360C]" />}
          title="單字拼寫"
          subtitle="Viết chính tả"
          desc="看中文，練習輸入越南語"
          rightIcon={<ScooterIcon className="w-20 h-16 opacity-90" />}
        />
      </div>

      {/* 隨機文化小知識卡片 */}
      <div className="mt-4 w-full glass-card p-5 rounded-2xl flex items-center gap-4 border-l-4 border-[#FFCA28] transition-all hover:shadow-lg">
        {/* NEW FIXED ICON */}
        <div className="w-14 h-14 bg-[#FFF8E1] rounded-full flex flex-col items-center justify-center flex-shrink-0 border-2 border-[#FFCA28] shadow-sm">
          <span className="text-xs font-bold text-[#F57F17] leading-none mb-0.5">小</span>
          <span className="text-xs font-bold text-[#F57F17] leading-none">知識</span>
        </div>
        <div>
          <h4 className="font-bold text-[#5D4037] text-lg cute-font flex items-center gap-2">
            {dailyFact.title}
          </h4>
          <p className="text-[#795548] text-xs mt-1 leading-relaxed">
            {dailyFact.content}
          </p>
        </div>
      </div>
    </div>
  );
};

// 封裝選單卡片
const MenuCard = ({ onClick, theme, icon, title, subtitle, desc, rightIcon }) => {
  const themes = {
    green: { bg: 'bg-[#F1F8E9]', border: 'border-[#DCEDC8]', text: 'text-[#33691E]', hover: 'hover:border-[#AED581]' },
    blue: { bg: 'bg-[#E1F5FE]', border: 'border-[#B3E5FC]', text: 'text-[#0277BD]', hover: 'hover:border-[#4FC3F7]' },
    red: { bg: 'bg-[#FBE9E7]', border: 'border-[#FFCCBC]', text: 'text-[#D84315]', hover: 'hover:border-[#FFAB91]' },
  };
  
  const t = themes[theme] || themes.green;

  return (
    <button 
      onClick={onClick}
      className={`
        relative w-full p-5 rounded-2xl text-left transition-all duration-300 
        border shadow-sm hover:shadow-md hover:-translate-y-1 overflow-hidden
        ${t.bg} ${t.border} ${t.hover}
      `}
    >
      <div className="flex justify-between items-center relative z-10">
        <div className="flex items-start gap-4">
          <div className="bg-white/80 p-3 rounded-xl shadow-sm border border-white/60">
            {icon}
          </div>
          <div>
            <h3 className={`text-lg font-bold ${t.text}`}>{title}</h3>
            <span className="text-[10px] font-bold opacity-60 uppercase tracking-widest block mb-1">{subtitle}</span>
            <p className="text-[#5D4037] text-xs opacity-80 font-medium">{desc}</p>
          </div>
        </div>
        <div className="transform translate-x-2 translate-y-1">
           {rightIcon}
        </div>
      </div>
    </button>
  );
};

// ==========================================
// 2. 基礎教室視圖
// ==========================================
const LearningView = ({ goHome, speak }) => {
  const [tab, setTab] = useState('cards');
  const [filter, setFilter] = useState('全部');
  const [cardIndex, setCardIndex] = useState(0);
  const [isFlipped, setIsFlipped] = useState(false);

  const filteredData = useMemo(() => {
    return filter === '全部' 
      ? vocabularyData 
      : vocabularyData.filter(item => item.category === filter);
  }, [filter]);

  useEffect(() => {
    setCardIndex(0);
    setIsFlipped(false);
  }, [filter]);

  const nextCard = () => {
    setIsFlipped(false);
    setTimeout(() => {
      setCardIndex((prev) => (prev + 1) % filteredData.length);
    }, 150);
  };

  const prevCard = () => {
    setIsFlipped(false);
    setTimeout(() => {
      setCardIndex((prev) => (prev - 1 + filteredData.length) % filteredData.length);
    }, 150);
  };

  const currentCard = filteredData[cardIndex];

  return (
    <div className="flex flex-col gap-5 animate-fade-in pb-20">
      {/* Header */}
      <div className="flex justify-between items-center">
        <button onClick={goHome} className="text-[#5D4037] hover:text-[#3E2723] flex items-center gap-1 text-sm font-bold bg-white/80 px-3 py-1.5 rounded-full shadow-sm border border-[#D7CCC8]">
          <ChevronLeft size={16} /> 返回
        </button>
        <div className="text-[#33691E] bg-[#DCEDC8] px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 border border-[#AED581]">
          <GraduationCap size={14} /> 基礎教室
        </div>
      </div>

      {/* Tabs */}
      <div className="flex p-1 bg-[#D7CCC8]/30 rounded-xl shadow-inner border border-[#D7CCC8]/50">
        <button 
          onClick={() => setTab('cards')}
          className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${tab === 'cards' ? 'bg-white text-[#5D4037] shadow-sm' : 'text-[#8D6E63] hover:text-[#5D4037]'}`}
        >
          單字卡 ({vocabularyData.length})
        </button>
        <button 
          onClick={() => setTab('tones')}
          className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${tab === 'tones' ? 'bg-white text-[#5D4037] shadow-sm' : 'text-[#8D6E63] hover:text-[#5D4037]'}`}
        >
          字母與聲調
        </button>
      </div>

      {tab === 'tones' ? (
        <div className="flex flex-col gap-6 animate-slide-up">
          {/* 聲調介紹 */}
          <div className="glass-card p-6 rounded-3xl relative overflow-hidden border-t-4 border-[#EC407A]">
            <h3 className="font-bold text-lg text-[#880E4F] mb-4 flex items-center gap-2 relative z-10">
              <Music size={20} className="text-[#EC407A]" /> 六個聲調
            </h3>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-3 relative z-10">
              {tonesData.map((t, idx) => (
                <button 
                  key={idx}
                  onClick={() => speak(t.example)}
                  className="p-3 bg-white/60 rounded-2xl hover:bg-[#FCE4EC] text-left border border-[#F8BBD0] transition-all hover:scale-105 group shadow-sm"
                >
                  <div className="flex justify-between items-start">
                    <span className="font-bold text-[#C2185B] text-xl font-serif">{t.symbol}</span>
                    <Volume2 size={16} className="text-[#F06292] opacity-0 group-hover:opacity-100 transition-opacity" />
                  </div>
                  <div className="text-sm font-bold text-[#880E4F] mb-1">{t.name}</div>
                  <div className="text-[11px] text-[#AD1457] leading-tight opacity-70">{t.desc}</div>
                </button>
              ))}
            </div>
          </div>

          {/* 母音介紹 */}
          <div className="glass-card p-6 rounded-3xl relative overflow-hidden border-t-4 border-[#7E57C2]">
            <h3 className="font-bold text-lg text-[#311B92] mb-4 flex items-center gap-2 relative z-10">
              <span className="text-[#651FFF] text-2xl font-serif">aăâ</span> 特殊母音
            </h3>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-3 relative z-10">
              {vowelsData.map((v, idx) => (
                <button 
                  key={idx}
                  onClick={() => speak(v.char)}
                  className="flex items-center gap-3 p-3 bg-white/60 rounded-2xl hover:bg-[#EDE7F6] border border-[#D1C4E9] transition-colors group shadow-sm"
                >
                  <span className="w-10 h-10 bg-[#673AB7] rounded-xl flex items-center justify-center font-bold text-white shadow-sm text-lg">
                    {v.char}
                  </span>
                  <span className="text-xs text-[#4527A0] font-medium">{v.desc}</span>
                </button>
              ))}
            </div>
          </div>
        </div>
      ) : (
        <div className="flex flex-col items-center gap-4 animate-slide-up h-full">
          {/* 分類過濾器 */}
          <div className="w-full overflow-x-auto pb-2 scrollbar-hide">
            <div className="flex gap-2 px-1">
              {categories.map(cat => (
                <button
                  key={cat}
                  onClick={() => setFilter(cat)}
                  className={`
                    px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition-all border
                    ${filter === cat 
                      ? 'bg-[#33691E] text-white border-[#33691E] shadow-md transform scale-105' 
                      : 'bg-white text-[#5D4037] border-[#D7CCC8] hover:bg-[#EFEBE9]'}
                  `}
                >
                  {cat}
                </button>
              ))}
            </div>
          </div>

          {/* 3D 翻轉卡片 */}
          <div className="relative w-full h-80 perspective-1000 group cursor-pointer mt-2" onClick={() => setIsFlipped(!isFlipped)}>
            <div className={`relative w-full h-full transition-all duration-700 preserve-3d transform ${isFlipped ? 'rotate-y-180' : ''}`} style={{ transformStyle: 'preserve-3d' }}>
              
              {/* 正面 (越南文) */}
              <div className="absolute top-0 left-0 w-full h-full backface-hidden bg-white rounded-[2rem] shadow-xl border-4 border-[#FFF9C4] flex flex-col items-center justify-center p-6 text-center overflow-hidden">
                <div className="absolute top-0 w-full h-24 bg-gradient-to-b from-[#FFFDE7] to-transparent"></div>
                <div className="absolute top-0 right-0 p-4 opacity-20"><AoDaiHatIcon className="w-20 h-20" /></div>

                <div className="z-10 flex flex-col items-center w-full">
                  <span className="text-xs font-bold bg-[#FFF59D] text-[#F57F17] px-3 py-1 rounded-full uppercase tracking-wide border border-[#FBC02D] mb-6 shadow-sm">
                    {currentCard.category}
                  </span>
                  
                  <h2 className="text-5xl md:text-6xl font-bold text-[#C62828] cute-font mb-4 drop-shadow-sm">{currentCard.vi}</h2>
                  
                  <div className="mt-8 text-[#9E9D24] text-xs font-bold flex items-center gap-1 bg-[#F9FBE7] px-3 py-1 rounded-full border border-[#F0F4C3]">
                    <RotateCw size={12} /> 翻轉看中文
                  </div>
                  
                  {/* 修改：將聲音按鈕移至右下角，並調整樣式 */}
                  <button 
                    onClick={(e) => { e.stopPropagation(); speak(currentCard.vi); }}
                    className="absolute bottom-4 right-4 w-12 h-12 rounded-full bg-[#C62828] text-[#FFFDE7] flex items-center justify-center hover:bg-[#B71C1C] shadow-lg shadow-red-200 hover:scale-110 transition-transform z-20 border-2 border-white"
                  >
                    <Volume2 size={20} />
                  </button>
                </div>
              </div>

              {/* 背面 (中文) - 復古深色 */}
              <div className="absolute top-0 left-0 w-full h-full backface-hidden bg-[#4E342E] rounded-[2rem] shadow-xl text-[#FFF8E1] flex flex-col items-center justify-center p-6 text-center rotate-y-180 border-4 border-[#8D6E63]">
                 <div className="absolute top-6 right-8 text-white/10 font-black text-4xl font-serif">ZH</div>
                 
                 <div className="flex-1 flex flex-col items-center justify-center">
                    <h2 className="text-4xl md:text-5xl font-bold mb-4">{currentCard.zh}</h2>
                    <div className="inline-block bg-white/10 backdrop-blur-sm px-6 py-2 rounded-xl border border-white/20">
                       <p className="font-mono text-xl tracking-wide text-[#FFCC80]">/{currentCard.guide}/</p>
                    </div>
                 </div>

                 <div className="mb-6 opacity-60 text-xs font-bold flex items-center gap-1">
                  <RotateCw size={12} /> 翻轉回正面
                </div>
              </div>

            </div>
          </div>

          {/* 控制按鈕 */}
          <div className="flex items-center gap-6 mt-4 w-full justify-center">
            <button 
              onClick={prevCard} 
              className="p-4 bg-white rounded-full shadow-md text-[#5D4037] border border-[#D7CCC8] hover:bg-[#EFEBE9] hover:scale-110 transition-all active:scale-95"
            >
              <ChevronLeft size={24} />
            </button>
            <div className="font-bold text-[#5D4037] text-sm bg-white px-4 py-2 rounded-full shadow-sm border border-[#D7CCC8]">
              {cardIndex + 1} <span className="text-[#A1887F] mx-1">/</span> {filteredData.length}
            </div>
            <button 
              onClick={nextCard} 
              className="p-4 bg-white rounded-full shadow-md text-[#5D4037] border border-[#D7CCC8] hover:bg-[#EFEBE9] hover:scale-110 transition-all active:scale-95"
            >
              <ChevronRight size={24} />
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

// ==========================================
// 3. 聽力遊戲組件
// ==========================================
const ListeningGame = ({ goHome, speak, addScore }) => {
  const [currentQ, setCurrentQ] = useState(null);
  const [options, setOptions] = useState([]);
  const [status, setStatus] = useState('playing'); 
  const [selectedOption, setSelectedOption] = useState(null);

  const initQuestion = () => {
    const randomIdx = Math.floor(Math.random() * vocabularyData.length);
    const question = vocabularyData[randomIdx];
    
    let wrongOptions = vocabularyData
      .filter(item => item.id !== question.id)
      .sort(() => 0.5 - Math.random())
      .slice(0, 3);
      
    const allOptions = [question, ...wrongOptions].sort(() => 0.5 - Math.random());
    
    setCurrentQ(question);
    setOptions(allOptions);
    setStatus('playing');
    setSelectedOption(null);
    
    setTimeout(() => speak(question.vi), 300);
  };

  useEffect(() => {
    initQuestion();
  }, []);

  const handleAnswer = (item) => {
    if (status !== 'playing') return;
    
    setSelectedOption(item.id);
    if (item.id === currentQ.id) {
      setStatus('correct');
      speak("Đúng rồi");
      addScore();
    } else {
      setStatus('wrong');
      speak("Sai rồi");
    }
  };

  if (!currentQ) return <div className="text-center p-10">準備中...</div>;

  return (
    <div className="flex flex-col gap-6 animate-fade-in pb-20">
      <div className="flex justify-between items-center">
        <button onClick={goHome} className="text-[#5D4037] hover:text-[#3E2723] flex items-center gap-1 text-sm font-bold bg-white/80 px-3 py-1.5 rounded-full shadow-sm border border-[#D7CCC8]">
          <ChevronLeft size={16} /> 返回
        </button>
        <div className="text-[#0277BD] bg-[#E1F5FE] px-3 py-1 rounded-full text-xs font-bold border border-[#B3E5FC]">
          聽力練習
        </div>
      </div>

      {/* 題目區塊 */}
      <div className="bg-white rounded-[2rem] p-8 shadow-lg border-2 border-[#B3E5FC] flex flex-col items-center justify-center gap-4 relative overflow-hidden">
        <div className="absolute top-0 right-0 opacity-20 transform rotate-12">
            <JunkBoatIcon className="w-32 h-32" />
        </div>
        
        <div className="z-10 flex flex-col items-center w-full">
          <button 
            onClick={() => speak(currentQ.vi)}
            className={`
              w-24 h-24 rounded-full flex items-center justify-center shadow-2xl transition-all duration-300 border-4 border-white
              ${status === 'playing' ? 'bg-[#29B6F6] hover:bg-[#039BE5] hover:scale-105 cursor-pointer animate-pulse-slow' : 'bg-[#B0BEC5]'}
            `}
          >
            <Volume2 size={40} className="text-white" />
          </button>
          
          <div className="mt-4 h-12 flex items-center justify-center">
            {status !== 'playing' ? (
               <div className="text-center animate-bounce-in">
                 <h3 className="text-3xl font-bold text-[#0277BD] cute-font">{currentQ.vi}</h3>
                 <p className="text-[#546E7A] text-xs mt-1 font-medium">/{currentQ.guide}/</p>
               </div>
            ) : (
              <span className="text-[#78909C] text-xs font-bold bg-[#ECEFF1] px-3 py-1 rounded-full">再次聆聽</span>
            )}
          </div>
        </div>
      </div>

      {/* 選項區塊 */}
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
        {options.map((opt) => (
          <button
            key={opt.id}
            onClick={() => handleAnswer(opt)}
            disabled={status !== 'playing'}
            className={`
              relative p-4 rounded-xl border-2 font-bold text-lg transition-all duration-200
              flex items-center justify-center shadow-sm
              ${status === 'playing' 
                ? 'bg-white border-[#CFD8DC] hover:border-[#4FC3F7] hover:bg-[#E1F5FE] text-[#455A64] hover:-translate-y-0.5' 
                : opt.id === currentQ.id
                  ? 'bg-[#C8E6C9] border-[#43A047] text-[#1B5E20] ring-2 ring-[#A5D6A7] ring-offset-1'
                  : opt.id === selectedOption 
                    ? 'bg-[#FFEBEE] border-[#EF5350] text-[#B71C1C] opacity-60'
                    : 'bg-[#F5F5F5] border-transparent text-[#B0BEC5] opacity-40'
              }
            `}
          >
            {opt.zh}
            {status !== 'playing' && opt.id === currentQ.id && <Check className="absolute right-4 text-[#2E7D32]" size={20} />}
          </button>
        ))}
      </div>

      {/* 下一題按鈕 */}
      {status !== 'playing' && (
        <button 
          onClick={initQuestion}
          className="w-full py-4 bg-[#0277BD] text-white rounded-2xl font-bold shadow-lg hover:bg-[#01579B] hover:scale-[1.02] transition-all flex items-center justify-center gap-2 animate-slide-up"
        >
          下一題 <ArrowRight size={20} />
        </button>
      )}
    </div>
  );
};

// ==========================================
// 4. 拼寫遊戲組件
// ==========================================
const WritingGame = ({ goHome, speak, addScore }) => {
  const [currentQ, setCurrentQ] = useState(null);
  const [inputVal, setInputVal] = useState('');
  const [status, setStatus] = useState('playing');
  const [hint, setHint] = useState(false);

  const initQuestion = () => {
    const randomIdx = Math.floor(Math.random() * vocabularyData.length);
    setCurrentQ(vocabularyData[randomIdx]);
    setInputVal('');
    setStatus('playing');
    setHint(false);
  };

  useEffect(() => {
    initQuestion();
  }, []);

  const checkAnswer = (e) => {
    e.preventDefault();
    if (!inputVal.trim()) return;

    if (inputVal.trim().toLowerCase() === currentQ.vi.toLowerCase()) {
      setStatus('correct');
      speak(currentQ.vi);
      speak("Tuyệt vời");
      addScore();
    } else {
      setStatus('wrong');
      speak("Cố lên");
    }
  };

  if (!currentQ) return <div>準備中...</div>;

  return (
    <div className="flex flex-col gap-6 animate-fade-in pb-20">
      <div className="flex justify-between items-center">
        <button onClick={goHome} className="text-[#5D4037] hover:text-[#3E2723] flex items-center gap-1 text-sm font-bold bg-white/80 px-3 py-1.5 rounded-full shadow-sm border border-[#D7CCC8]">
          <ChevronLeft size={16} /> 返回
        </button>
        <div className="text-[#BF360C] bg-[#FBE9E7] px-3 py-1 rounded-full text-xs font-bold border border-[#FFCCBC]">
          拼寫挑戰
        </div>
      </div>

      <div className="bg-white rounded-[2.5rem] p-8 shadow-xl border-b-8 border-[#FFAB91] text-center relative overflow-hidden">
        {/* 背景裝飾 */}
        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-[#FF7043] to-[#FFCA28]"></div>
        <div className="absolute -bottom-4 -right-4 opacity-10 transform -rotate-12">
            <ScooterIcon className="w-40 h-32" />
        </div>

        <div className="relative z-10">
          <span className="text-[10px] font-bold tracking-widest text-[#FF7043] uppercase bg-[#FBE9E7] px-2 py-1 rounded border border-[#FFAB91]">Translate to Vietnamese</span>
          <h2 className="text-4xl md:text-5xl font-bold text-[#3E2723] cute-font mt-4 mb-2">{currentQ.zh}</h2>
          
          {hint && (
            <div className="text-[#D84315] font-medium animate-fade-in mt-2 inline-flex items-center gap-2 bg-[#FBE9E7] px-4 py-1 rounded-full text-sm">
              <Star size={14} fill="currentColor" /> 提示: {currentQ.vi[0]}... <span className="opacity-60">({currentQ.guide})</span>
            </div>
          )}

          <form onSubmit={checkAnswer} className="w-full max-w-sm mx-auto flex flex-col gap-4 mt-6">
            <input
              type="text"
              value={inputVal}
              onChange={(e) => setInputVal(e.target.value)}
              disabled={status === 'correct'}
              placeholder="在此輸入..."
              className={`
                w-full p-4 text-center text-2xl rounded-2xl border-2 outline-none transition-all font-bold shadow-inner placeholder:text-[#CFD8DC]
                ${status === 'correct' 
                  ? 'border-[#43A047] bg-[#E8F5E9] text-[#1B5E20]' 
                  : status === 'wrong'
                    ? 'border-[#E57373] bg-[#FFEBEE] text-[#B71C1C] focus:border-[#F44336]'
                    : 'border-[#CFD8DC] bg-[#F5F5F5] text-[#37474F] focus:border-[#FF7043] focus:bg-white focus:shadow-lg'
                }
              `}
            />
            
            {status === 'playing' ? (
               <div className="flex gap-3 mt-2">
                  <button 
                    type="button" 
                    onClick={() => setHint(true)}
                    className="flex-1 py-3 rounded-xl border-2 border-[#D7CCC8] text-[#8D6E63] font-bold hover:bg-[#EFEBE9] hover:border-[#BCAAA4] transition-colors"
                  >
                    提示
                  </button>
                  <button 
                    type="submit" 
                    className="flex-[2] py-3 bg-gradient-to-r from-[#FF7043] to-[#F4511E] hover:from-[#F4511E] hover:to-[#D84315] text-white rounded-xl font-bold shadow-lg shadow-orange-200 transition-all hover:-translate-y-0.5 active:translate-y-0"
                  >
                    檢查答案
                  </button>
               </div>
            ) : (
              <div className="flex flex-col gap-4 animate-slide-up mt-2">
                {status === 'wrong' && (
                   <div className="bg-[#FFEBEE] p-3 rounded-xl border border-[#FFCDD2]">
                     <span className="text-[#E57373] text-sm font-bold block mb-1">正確答案</span>
                     <span className="text-[#C62828] text-2xl font-bold">{currentQ.vi}</span>
                   </div>
                )}
                <button 
                  type="button"
                  onClick={initQuestion}
                  className={`
                    w-full py-4 rounded-xl font-bold text-white shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2
                    ${status === 'correct' ? 'bg-[#43A047] hover:bg-[#2E7D32]' : 'bg-[#546E7A] hover:bg-[#455A64]'}
                  `}
                >
                  {status === 'correct' ? <span>下一題 <ArrowRight size={18} className="inline"/></span> : '再試一題'}
                </button>
              </div>
            )}
          </form>
        </div>
      </div>

      {/* 特殊符號鍵盤 */}
      <div className="mt-2">
        <p className="text-xs text-center text-[#90A4AE] font-bold mb-3 uppercase tracking-wider">特殊符號輔助</p>
        <div className="flex flex-wrap justify-center gap-2">
          {['ă', 'â', 'đ', 'ê', 'ô', 'ơ', 'ư', 'à', 'á', 'ả', 'ã', 'ạ'].map(char => (
            <button key={char} 
              onClick={() => setInputVal(v => v + char)}
              className="w-10 h-10 flex items-center justify-center bg-white rounded-xl shadow-sm border-b-4 border-[#CFD8DC] text-[#455A64] font-bold hover:bg-[#FBE9E7] hover:border-[#FFCCBC] hover:text-[#D84315] active:border-b-0 active:translate-y-1 transition-all"
            >
              {char}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};
